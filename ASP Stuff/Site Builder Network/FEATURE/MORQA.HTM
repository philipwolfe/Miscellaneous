
<HTML>
<HEAD>


<TITLE>SBN Ask Tom: Server Q &amp; A</TITLE>

<META NAME="Description" CONTENT="Tom Moran answers questions about server-related issues" />
<META NAME="Keywords" CONTENT="Active Server Pages" />
<META NAME="Robots" CONTENT="All" />

<META NAME="Author" CONTENT="Tom Moran" />
<META NAME="Posted" CONTENT="" />
<META NAME="Updated" CONTENT="09/30/1998" />

<META NAME="MS.LOCALE" CONTENT="EN-US" />
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1" />

<LINK REL="stylesheet" TYPE="text/css" HREF="../../../sitebuilder/shared/css/navbar.css" />
<LINK REL="stylesheet" TYPE="text/css" HREF="../../../sitebuilder/shared/css/ie4-wks.css" />


<SCRIPT LANGUAGE="JavaScript"><!--

// -----------------------------------------------------------
// Client-side BrowserData constructor
// Populated using data from server-side oBD object to avoid redundancy
// -----------------------------------------------------------

function BrowserData()
{
this.userAgent = "Mozilla/4.0 (compatible; MSIE 4.01; Windows NT)";
this.browser = "MSIE";
this.majorVer = "4";
this.minorVer = "01";
this.betaVer = 0;
this.platform = "NT";
this.getsNavBar = true;
this.doesActiveX = true;

}
var oBD = new BrowserData();

//--></SCRIPT>

<SCRIPT LANGUAGE="Javascript"><!--

// -----------------------------------------------------------
// window_load()
// Container function for load.
// -----------------------------------------------------------

function window_load()
{
if (oBD.getsNavBar)
{
if ("function" == typeof(InitNavLinks)) InitNavLinks();
if ("function" == typeof(CheckToTop)) CheckToTop();
}
}
window.onload = window_load;

//--></SCRIPT>

</HEAD>

<BODY TOPMARGIN="0" LEFTMARGIN="0" MARGINHEIGHT="0" MARGINWIDTH="0" BGCOLOR="#FFFFFF">


<TABLE WIDTH="100%" CELLPADDING="0" CELLSPACING="0" BORDER="0">
<TR>
<TD ROWSPAN="2" WIDTH="460" VALIGN="top"><NOBR><A HREF="http://www.microsoft.com/" TARGET="_top"><IMG SRC="../../../library/images/gifs/toolbar/home.gif" WIDTH="103" HEIGHT="21" ALT="Microsoft Home" BORDER="0"></A><A HREF="http://www.microsoft.com/PRODUCTS/DEFAULT.asp?DIVISIONID="10"" TARGET="_top"><IMG SRC="../../../library/images/gifs/toolbar/prod.gif" WIDTH="81" HEIGHT="21" ALT="products" BORDER="0"></A><A HREF="http://www.microsoft.com/search/default.asp" TARGET="_top"><IMG SRC="../../../library/images/gifs/toolbar/search.gif" WIDTH="68" HEIGHT="21" ALT="search" BORDER="0"></A><A HREF="http://www.microsoft.com/ISAPI/GOSUPPORT.asp?TARGET=/SUPPORT/" TARGET="_top"><IMG SRC="../../../library/images/gifs/toolbar/support.gif" WIDTH="74" HEIGHT="21" ALT="support" BORDER="0"></A><A HREF="http://www.microsoft.com/referral/default.asp" TARGET="_top"><IMG SRC="../../../library/images/gifs/toolbar/shop.gif" WIDTH="55" HEIGHT="21" ALT="shop" BORDER="0"></A><A HREF="http://www.microsoft.com/ISAPI/GOREGWIZ.asp?TARGET=/REGWIZ/REGWIZ.asp" TARGET="_top"><IMG SRC="../../../library/images/gifs/toolbar/write.gif" WIDTH="78" HEIGHT="21" ALT="Write Us" BORDER="0"></A><IMG SRC="../../../library/images/gifs/toolbar/spacer.gif" WIDTH="1" HEIGHT="21" ALT="" BORDER="0"></NOBR></TD>
<TD BGCOLOR="#000000" WIDTH="100%" HEIGHT="20">&nbsp;</TD>
<TD ROWSPAN="2" WIDTH="91" ALIGN="right" VALIGN="top"><A HREF="http://www.microsoft.com/" TARGET="_top"><IMG SRC="../../../library/images/gifs/toolbar/msft.gif" WIDTH="91" HEIGHT="21" ALT="Microsoft Home" BORDER="0"></A></TD>
</TR>
<TR>
<TD COLSPAN="3" BGCOLOR="#FFFFFF" WIDTH="100%" HEIGHT="1"></TD>
</TR>
</TABLE>

<TABLE ID="tblNavBar" BORDER="0" CELLPADDING="0" CELLSPACING="0">
<TR VALIGN="top">
<TD CLASS="clsSBNLogo" TITLE="SBN Home" HEIGHT="34" WIDTH="90"><A HREF="/sitebuilder/default.htm" TARGET="_top" expNoTOC="true"><IMG HEIGHT="34" WIDTH="90" BORDER="0" SRC="../../../sitebuilder/shared/navbar/graphics/sbnbrand2.gif" ALT="SBN Home" /></A></TD>
<TD CLASS="clsNavBarItem" expItemNum="1">Magazine<BR><IMG HEIGHT="4" WIDTH="7" BORDER="0" SRC="../../../sitebuilder/shared/navbar/graphics/arrow.gif"></TD>
<TD>&nbsp;|&nbsp;</TD>
<TD CLASS="clsNavBarItem" expItemNum="2">Community<BR><IMG HEIGHT="4" WIDTH="7" BORDER="0" SRC="../../../sitebuilder/shared/navbar/graphics/arrow.gif"></TD>
<TD>&nbsp;|&nbsp;</TD>
<TD CLASS="clsNavBarItem" expItemNum="3">Workshop<BR><IMG HEIGHT="4" WIDTH="7" BORDER="0" SRC="../../../sitebuilder/shared/navbar/graphics/arrow.gif"></TD>
<TD>&nbsp;|&nbsp;</TD>
<TD CLASS="clsNavBarItem" expItemNum="4">Tools&nbsp;&amp;&nbsp;Samples<BR><IMG HEIGHT="4" WIDTH="7" BORDER="0" SRC="../../../sitebuilder/shared/navbar/graphics/arrow.gif"></TD>
<TD>&nbsp;|&nbsp;</TD>
<TD CLASS="clsNavBarItem" expItemNum="5">Training<BR><IMG HEIGHT="4" WIDTH="7" BORDER="0" SRC="../../../sitebuilder/shared/navbar/graphics/arrow.gif"></TD>
<TD>&nbsp;|&nbsp;</TD>
<TD CLASS="clsNavBarItem" expItemNum="6">Site&nbsp;Info<BR><IMG HEIGHT="4" WIDTH="7" BORDER="0" SRC="../../../sitebuilder/shared/navbar/graphics/arrow.gif"></TD>
<TD WIDTH="100%"></TD>
</TR>
</TABLE>


<TABLE ID="tblNavLinks" CLASS="clsNavLinks" CELLPADDING="0" CELLSPACING="0" BORDER="0" WIDTH="100%">
<TR>
<TD COLSPAN="2" HEIGHT="8"><IMG WIDTH="1" HEIGHT="8" SRC="../../../sitebuilder/shared/graphics/trans.gif"></TD>
<TD ROWSPAN="2"><A HREF="../../../workshop/default.htm" TARGET="_top"><IMG ALIGN="right" HEIGHT="30" WIDTH="106" BORDER="0" ALT="Click to return to the Workshop home page" SRC="../../../workshop/graphics/wrkbrand2.gif" /></A><BR /></TD>
</TR>
<TR>
<TD ROWSPAN="2">
<A HREF="../../../workshop/server/pg00164.htm"><IMG HEIGHT="32" WIDTH="31" HSPACE="25" BORDER="0" ALT="Click to return to the Server Technologies home page" SRC="../../../workshop/graphics/icons//server.gif" /></A>
</TD>
<TD>
<TABLE CELLPADDING="3" CELLSPACING="0" BORDER="0">
<TR>

<TD><A ID="lnkShowImg" HREF="../../../workshop/server/toc.htm" TARGET="_top"><IMG ID="imgShow" CLASS="clsLeftMenu" HEIGHT="15" WIDTH="18" BORDER="0" SRC="../../../workshop/graphics/icons/nl-show-0.gif" ALT="" /></A><BR></TD>
<TD NOWRAP><A ID="lnkShowText" CLASS="clsLeftMenu" HREF="../../../workshop/server/toc.htm" TARGET="_top">show toc</A> &nbsp;&nbsp; </TD>

<TD><A ID="lnkSyncImg" HREF="../../../workshop/pg05227.htm#/workshop/server/feature/morqa.htm" TARGET="_top"><IMG ID="imgSync" CLASS="clsLeftMenu" HEIGHT="15" WIDTH="18" BORDER="0" SRC="../../../workshop/graphics/icons/nl-sync-0.gif" ALT="" /></A><BR></TD>
<TD NOWRAP><A ID="lnkSyncText" CLASS="clsLeftMenu" HREF="../../../workshop/pg05227.htm#/workshop/server/feature/morqa.htm" TARGET="_top">sync toc</A> &nbsp;&nbsp; </TD>

<TD><A ID="lnkSearchImg" HREF="http://www.microsoft.com/isapi/gosearch.asp?TARGET=/dev/web/default.asp" TARGET="_top"><IMG ID="imgSearch" CLASS="clsLeftMenu" HEIGHT="15" WIDTH="18" BORDER="0" SRC="../../../workshop/graphics/icons/nl-search-0.gif" ALT="" /></A><BR></TD>
<TD NOWRAP><A ID="lnkSearchText" CLASS="clsLeftMenu" HREF="http://www.microsoft.com/isapi/gosearch.asp?TARGET=/dev/web/default.asp" TARGET="_top">search</A> &nbsp;&nbsp; </TD>

<TD><A ID="lnkIndexImg" HREF="../../../workshop/index/pg00001.htm"><IMG ID="imgIndex" CLASS="clsLeftMenu" HEIGHT="15" WIDTH="18" BORDER="0" SRC="../../../workshop/graphics/icons/nl-index-0.gif" ALT="" /></A><BR></TD>
<TD NOWRAP><A ID="lnkIndexText" CLASS="clsLeftMenu" HREF="../../../workshop/index/pg00001.htm">index</A> &nbsp;&nbsp; </TD>

</TR>
</TABLE>
</TD>
</TR>
<TR>
<TD COLSPAN="2" WIDTH="100%">
<TABLE CELLPADDING="2" CELLSPACING="0" BORDER="0">
<TR>
<TD>&nbsp;</TD>
</TR>
</TABLE>
</TD>
</TR>
</TABLE>

<BR CLEAR="all" />
<DIV CLASS="clsBucketBranch"><A HREF="../../../workshop/pg00004.htm" TARGET="_top">Workshop</A>&nbsp;&nbsp;|&nbsp;&nbsp;<A HREF="../../../workshop/pg05227.htm#/workshop/server/pg00164.htm" TARGET="_top">Server Technologies</A></DIV>

<DIV CLASS="clsDocBody">

<!-- DOCUMENT CONTENT START -->


<H1><A NAME="top" IDX_TYPES="sbngen" IDX_CONCEPT="stopindex; Server, ASP, Active Server Pages">Ask Tom: Server Q &amp; A</A></H1>
<HR SIZE="1" />
<P>Tom Moran
        <BR>Microsoft Corporation
<P>October 1, 1998
<P>
<P><a href="morqa.zip"><IMG SRC="../../../sitebuilder/graphics/icodownl.gif" BORDER=0 ALT="Download">Download Microsoft Word (.DOC) format of this document (zipped, 9.65K)</A> 

<P><i>The following questions and answers were originally published in the Site Builder Network Magazine &quot;<a href="../../../sitebuilder/magazine/server.htm" TARGET="_top">Servin' It Up</a>" column.</i>
<P><B>Contents</B>
<BR><a href="morqa.htm#mail">How do I send mail from an ASP page?</a>
<BR><a href="morqa.htm#em">What is this 80004005 error message, and what can I do about it?</a>
<BR><a href="morqa.htm#auth">How do I give everyone in my company authenticated access to specific Web pages?</a>
<BR><a href="morqa.htm#session">Can I use session object variables with multiple servers?</a>
<BR><a href="morqa.htm#incl">How do I conditionally include files (AKA, virtual include)?</a>
<BR><a href="morqa.htm#order">Why does the order of ASP execution seem to be so random?</a>
<BR><a href="morqa.htm#tips">Tom's tips: ASP performance</a></P>

<!-- start 062998.asp -->
<H4><a name="mail"></a>How do I send mail from an ASP page?</H4>
<P><b>Tom:</b> There are a several ways to do this.  The best right now is to use CDO (Collaboration Data Objects) for NTS, which is basically a lightweight version of the CDO for Exchange.  In the distant past, with Internet Information Server 3.0, some people used the Microsoft Personalization System <b>SendMail</b> component from Site Server 2.0 to send mail.  However, with CDO is built into IIS 4.0, so you get it for free with the NT Option Pack.  You can also do things like send MIME encoded messages, which was unavailable with the older <b>SendMail </b>object.  For all intents and purposes, think of CDO for NTS as replacing the <b>SendMail</b> object.</P>
<P>At a minimal level, you can send mail from an ASP page using CDO in about four lines:</P>
<PRE class="clsCode">&lt;%
Dim myCDO
Set myCDO = Server.CreateObject(&quot;CDONTS.NewMail&quot;)
myCDO.Send "From@importantcustomer.com",
 "servin@microsoft.com&quot;,&quot;Servin It Up&quot;,
 &quot;Love your column. The Web Men are cool, too.&quot;
Set myCDO = nothing
%&gt;</PRE>
<P>Just replace your e-mail address in the "from@importantcustomer.com" section and run the above code.  I set the <b>myCDO</b> object to nothing at the end, since it can only be used once, and needs to be recreated every time a message is sent.
</P>
<P>You might want to use IF IsObject(myCDO) = FALSE to determine if the object was created correctly, as well as do any other error checking that might be important to you.  You can also set each parameter individually, instead of passing them all together as I did.  Parameters available are the usual e-mail parameters of <i>to:</i>, <i>importance</i>, <i>subject</i>, f<i>ile attachments</i>, <i>body</i>, etc.
</P>
<P>If this doesn't work upon first try, you probably need to go into the Microsoft Management Console (MMC) and ensure that you have correctly installed the SMTP (Simple Mail Transfer Protocol) service.  The SMTP service is installed by default for IIS 4.0, so you should at least have it installed.  And contrary to popular opinion, you do not need to have Exchange installed.  In fact, as long as the SMTP Service is running on your server, it can point to any valid SMTP server.
</P>
<P>If there is enough interest, I'll put together a complete sample application that shows some variations on how to work with the CDO and post it here next month.  There are a lot of things you can do, including mailing from forms, including HTML as a body, and attaching files.
</P>
<P><B>Resources:</B>
</P>
<UL>
<LI> NT Option pack, which, if you are on your NT machine, is probably at http://localhost/iishelp/iis/misc (remember, this link only works if you are using a machine which has the Windows NT Server Option Pack installed)<LI> <A HREF="http://www.15seconds.com/Issue/980325.htm" TARGET="_top">Collaboration Data Object and IIS 4.0</a>&nbsp;<IMG SRC="../../../sitebuilder/graphics/leave-ms.gif" WIDTH="33" HEIGHT="11" BORDER="0" ALT="Non-MS link"> by John Whiting, on the 15seconds.com Web site
</UL>
<P>Although I've never used them, there are two commercially available products that may make it easier to send mail.  Here are the links to Server Objects Inc.:
</P>
<UL>
<LI>  <A HREF="http://www.serverobjects.com/products.htm" TARGET="_top">
ASPMail</A>&#153&nbsp;<IMG SRC="../../../sitebuilder/graphics/leave-ms.gif" WIDTH="33" HEIGHT="11" BORDER="0" ALT="Non-MS link">
<LI><A HREF="http://www.serverobjects.com/products.htm" TARGET="_top">ASPQMail</A>&#153&nbsp;<IMG SRC="../../../sitebuilder/graphics/leave-ms.gif" WIDTH="33" HEIGHT="11" BORDER="0" ALT="Non-MS link">
</UL>
<P><A HREF="morqa.htm#top" CLASS="clsBackTop"><IMG SRC="../../../workshop/graphics/top.gif" WIDTH="18" HEIGHT="8" BORDER="0" ALT="Back to top">Back to top</A></P>


<H4><a name="em"></a>What is this 80004005 error message, and what can I do about it?</H4>
<P><b>Tom:</b>  This is the most common error you'll see.  It is a general error telling you the data you want cannot be accessed for some reason.  Usually you'll get a moderately helpful explanation along with the 80004005 notification.  In most cases, it comes down to lack of permission or DSN naming problems.  However, note that you can get this for other reasons as well, including the wrong type of parameter sent to a SQL Stored Procedure.  The error is actually bubbled up from the data provider, so sometimes it can be hard to tell exactly what happened or where.</P>
<P>To troubleshoot, you first need to check your permissions.  The <A HREF="http://www.microsoft.com/isapi/gosupport.asp?TARGET=/support/kb/articles/q175/6/71.asp" TARGET="_top">Microsoft Knowledge Base article Q175671</A> <IMG SRC="../../../sitebuilder/graphics/leave-site.gif" WIDTH="17" HEIGHT="11" BORDER="0" ALT="Non-SBN link"> has some good trouble-shooting tips.  Make sure that your account has full permission on the directory that contains the data and files. This means that, if you are using anonymous access, the IUSR_&lt;machine name&gt; account needs to have that access.  You can also temporarily add the IUSR account to the Administrators.</P><P>If everything works now, you know there is some sort of account-permissions problem and can start troubleshooting.  If things don't work, that wasn't the problem, so don't forget to set the permissions back to the way they were, especially if you added IUSR to the Administrator group.  Now, this could still be a permissions issue. Are the data source and IIS on the same machine?  If not, permission credentials can get lost in the whole delegation routine and cause problems.  If you are relying on authentication, you may need to change the default network protocol from what is probably Named Pipes to be TCP/IP Sockets (Transmission Control Protocol/Internet Protocol), which you can do through the SQL Server Client Configuration Utility.  The problem is that IIS tries to impersonate a user, but fails and is denied the connection. Next most common issue is with the DSN.  Just make sure that you haven't moved your data source from a test machine to somewhere else without changing the data names.  This is the most common related problem.</P>
<P>There are many causes of the 80004005 error, but they all have to do with some sort of problem getting to your data, and so are generally fairly easy to track down.  Start with permissions, check your DSN, and then start cruising the Microsoft Knowledge Base and you'll get there.</P>
<P><B>Resources:</B></P>
<P>Since each 80004005 that comes up may have a very specific set of circumstances, Microsoft Knowledge Base articles are your best source of information.  If you select All Products, you end up with various articles about Microsoft PowerPoint getting the error, and that's probably not what you want.  But if you just select ASP or ADO or Visual InterDev, you don't get the complete picture.</P>
<P>So I've done all the work of stripping out the most inappropriate articles. As long as you are registered with Support Online, you should be able to click to  <A HREF="/isapi/gosearch.asp?TARGET=/searchbin/kb/mts.idq?D=access+or+istudio+or+iis+or+axsf+or+vbapps+or+adobj+or+odbc&A=T&T=B&G=&Fr=0&S=F&T1=&Sz=80004005&O=80004005&MSCOM_SRV=http://www.microsoft.com" TARGET="_top">find the best articles on Support Online</A> <IMG SRC="../../../sitebuilder/graphics/leave-site.gif" WIDTH="17" HEIGHT="11" BORDER="0" ALT="Non-SBN link">.</P>
<P>The best article of the bunch is  <A HREF="http://www.microsoft.com/isapi/gosupport.asp?TARGET=/support/kb/articles/q183/0/60.asp" TARGET="_top">Q183060</A> <IMG SRC="../../../sitebuilder/graphics/leave-site.gif" WIDTH="17" HEIGHT="11" BORDER="0" ALT="Non-SBN link">.</P>
<P><A HREF="morqa.htm#top" CLASS="clsBackTop"><IMG SRC="../../../workshop/graphics/top.gif" WIDTH="18" HEIGHT="8" BORDER="0" ALT="Back to top">Back to top</A></P>
<!-- end 062998.asp -->

<!-- start 042798.asp -->
<h4><a name="auth"></a>How do I give everyone in my company authenticated access to specific Web pages?</h4>
<P><b>Tom:</b> Assuming you are on an NT network, just give the NT group &quot;Everyone&quot; access to the desired file or directory. Make sure, though, that you follow that up by disabling the IUSR_&lt;machine name&gt;account for that directory or file.  If you never have need for anonymous access, then simply remove that option from IIS for that Web completely.
</P>
<P><A HREF="morqa.htm#top" CLASS="clsBackTop"><IMG SRC="../../../workshop/graphics/top.gif" WIDTH="18" HEIGHT="8" BORDER="0" ALT="Back to top">Back to top</A></P>
<h4><a name="session"></a>Can I use session object variables with multiple servers?</h4>
<P><b>Tom:</b>  See the new Site Builder Network 
Workshop article <a href="../../../workshop/server/nextgen/sessiondata.htm">Using the Membership Directory and ActiveX User Object for Session State Data</A>. The basic problem is that the session is specific to the server that processes the request.  Site Server Personalization and Membership Services, however, were designed to provide this capability, and have several other benefits, such as potentially increased performance, easy access to all user data, and so forth. 
</P>
<P><A HREF="morqa.htm#top" CLASS="clsBackTop"><IMG SRC="../../../workshop/graphics/top.gif" WIDTH="18" HEIGHT="8" BORDER="0" ALT="Back to top">Back to top</A></P>
<!-- end 042798.asp -->

<!-- start 072998.asp -->
<H4><a name="incl"></a>How do I conditionally include files (AKA, virtual include)?</H4>
<P>
<b>Tom:</b> For those of you who haven't tried this, the idea is to be able to substitute the appropriate include file without knowing beforehand which file to include.  For example, if a person from the accounting team signs on, you want to include accounting.inc.  But if a person from the payroll department signs on, you want to include payroll.inc.  This is more difficult than it sounds.  Even a new programmer would quickly come up with the idea of creating a variable, filling it with the appropriate value, and referencing the variable inside the include statement.  
</P>
<PRE class="clsCode">&lt;% name=(header1 &amp; &quot;.inc&quot;)%&gt; 
&lt;!--#include file=&quot;&lt;%= name %&gt;&quot;--&gt;</PRE>
<P>Regrettably, building a filename to include doesn't work like that.  Your ASP page is compiled and executed before being sent to the client, which means that your variable isn't evaluated until after the include statement has been evaluated.  There are three common ways and one difficult way to work around this.  The first is to use the <b>FileSystemObject</b>, the second is to use a <b>select case</b> statement, the third is to use an if/then, and the difficult fourth is to write your own ISAPI DLL, which I won't go into here.  An ISAPI filter can process a file ahead of ASP, intercepting files first to do custom processing before it then passes the file on. Perhaps someone knows of one already written that is available on a Web site somewhere.  Let me know and I'll post a pointer to it.</P>  
<P>To find as much information as possible about this question, I did the following:</P>
<UL>


<LI> Searched the  <A HREF="http://www.microsoft.com/isapi/gosupport.asp?TARGET=/support/">Microsoft Knowledge Base</A> <IMG SRC="../../../sitebuilder/graphics/leave-site.gif" WIDTH="17" HEIGHT="11" BORDER="0" ALT="Non-SBN link">
<LI> Visited <A HREF="http://www.15seconds.com">www.15seconds.com</A>&nbsp;<IMG SRC="../../../sitebuilder/graphics/leave-ms.gif" WIDTH="33" HEIGHT="11" BORDER="0" ALT="Non-MS link"> and searched the FAQ and ListServ
<LI> Visited DejaNews and searched the newsgroup postings in the  newsgroup
<LI> Visited  <A HREF="http://www.activeserverpages.com/">www.activeserverpages.com</A> &nbsp;<IMG SRC="../../../sitebuilder/graphics/leave-ms.gif" WIDTH="33" HEIGHT="11" BORDER="0" ALT="Non-MS link"> and found the example from IIS that I used above to show what <i>doesn't</i> work

</UL>
<P><B>Using the FileSystemObject</B> (from an upcoming KB article by Shawn Vita):</P>

<PRE class="clsCode">&lt;% ' The name of the file to display was 
   passed by a form using GET method
infil = Request.QueryString(&quot;file&quot;) 
If infil &lt;&gt; &quot;&quot; then
   set fso = Server.CreateObject(&quot;Scripting.FileSystemObject&quot;)
   set fil = fso.OpenTextFile(infil)
   filout = fil.ReadAll
   ' PRE tags preserve the format of the file
   Response.write &quot;&lt;PRE&gt;&quot; &amp; filout &amp; &quot;&lt;/PRE&gt;&lt;BR&gt;&quot;
End If 
%&gt;</PRE>
<P>Unfortunately, files must contain straight text/HTML.  Due to the timing, files containing script will not work.</P>
<P>
<B>Using if/then</B> (from a post by Aaron Bertrand in the <A HREF="news://msnews.microsoft.com/microsoft.public.inetserver.iis.activeserverpages">ActiveServerPages Newsgroup</A>&nbsp;<IMG SRC="../../../sitebuilder/graphics/leave-ms.gif" WIDTH="33" HEIGHT="11" BORDER="0" ALT="Non-MS link">):</P>
<PRE class="clsCode">&lt;%
filename=request.querystring(&quot;Filename&quot;)
if filename=&quot;blah.txt&quot; then
%&gt;
&lt;!--#include file=&quot;blah.txt&quot;--&gt;
&lt;% elseif filename=&quot;blah2.txt&quot; %&gt; 
&lt;!--#include file=&quot;blah2.txt&quot;--&gt;
&lt;% end if %&gt;</PRE>
<P>Of course, each line is processed; it's just that the user will not see anything except the desired result.</P>
<P><B>Using the select case statement</B> (from a post on the ASP listserv by Chris Woodrow):</P>

<PRE class="clsCode">&lt;% select case includename %&gt;
&lt;% case &quot;file1&quot; %&gt; 
&lt;!--include..... file1 --&gt;
&lt;% case &quot;file2&quot; %&gt; 
&lt;!--include..... file2 --&gt;
&lt;% end select %&gt;</PRE>
<P>This is somewhat similar to the previous solution. Each file is loaded into memory, so this is not the most efficient way to do things, but it does get the job done.</P>

<P><A HREF="morqa.htm#top" CLASS="clsBackTop"><IMG SRC="../../../workshop/graphics/top.gif" WIDTH="18" HEIGHT="8" BORDER="0" ALT="Back to top">Back to top</A></P>

<!-- end 072998.asp -->

<!-- start of 090198.asp -->
<H4><a name="order"></a>Why does the order of ASP execution seem to be so random?  
</h4>
<P><b>Tom:</b>To illustrate this, look at the following two ASP files and the corresponding output:
</P>
<PRE class="clsCode">&lt;%@ Language=Javascript %&gt;
&lt;HTML&gt;
&lt;HEAD&gt;
&lt;META NAME=&quot;GENERATOR&quot; Content=&quot;Microsoft Visual 
  Studio 6.0&quot;&gt;
&lt;/HEAD&gt;
&lt;BODY&gt;
Block 1 - Straight HTML - Before the Code Block&lt;P&gt;

&lt;SCRIPT LANGUAGE=javascript RUNAT=Server&gt;
   Response.Write (&quot;Block 2 - 
     SCRIPT LANGUAGE=javascript 
     RUNAT=Server&lt;P&gt; &quot;);
&lt;/SCRIPT&gt;
&lt;%
   Response.Write (&quot;Block 3 - 
   Javascript using the script delimiters&lt;P&gt;&quot;)
%&gt;

&lt;SCRIPT LANGUAGE=VBScript RUNAT=Server&gt;
   Response.Write (&quot;Block 4 - 
     SCRIPT LANGUAGE=VBScript 
     RUNAT=Server&lt;P&gt;&quot;)
&lt;/SCRIPT&gt;
Block 5 - Straight HTML - After theCode Block&lt;P&gt;
&lt;/BODY&gt;
&lt;/HTML&gt;</PRE>
<P>Web Browser Output:
</P>
<PRE class="clsCode">Block 4 - SCRIPT LANGUAGE=VBScript RUNAT=Server 
Block 1 - Straight HTML - Before the Code Block 
Block 3 - Javascript using the script delimiters 
Block 5 - Straight HTML - After theCode Block 
Block 2 - SCRIPT LANGUAGE=javascript RUNAT=Server</PRE>
<P>If the following code is run (Default script language has been changed to VBScript)
</P>
<PRE class="clsCode">
&lt;%@ Language=VBScript %&gt;
&lt;HTML&gt;
&lt;HEAD&gt;
&lt;META NAME=&quot;GENERATOR&quot; Content=&quot;Microsoft Visual 
  Studio 6.0&quot;&gt;
&lt;/HEAD&gt;
&lt;BODY&gt;
Block 1 - Straight HTML - 
  Before the Code Block&lt;P&gt;

&lt;SCRIPT LANGUAGE=javascript RUNAT=Server&gt;
   Response.Write (&quot;Block 2 - 
     SCRIPT LANGUAGE=javascript 
     RUNAT=Server&lt;P&gt; &quot;);
&lt;/SCRIPT&gt;
&lt;%
   Response.Write (&quot;Block 3 - 
     Javascript using the script delimiters&lt;P&gt;&quot;)
%&gt;

&lt;SCRIPT LANGUAGE=VBScript RUNAT=Server&gt;
   Response.Write (&quot;Block 4 - 
     SCRIPT LANGUAGE=VBScript 
     RUNAT=Server&lt;P&gt;&quot;)
&lt;/SCRIPT&gt;
Block 5 - Straight HTML - 
  After theCode Block&lt;P&gt;
&lt;/BODY&gt;
&lt;/HTML&gt;</PRE>
<P>Web Browser Output:
</P>
<PRE class="clsCode">Block 2 - SCRIPT LANGUAGE=javascript RUNAT=Server 
Block 1 - Straight HTML - Before the Code Block 
Block 3 - Javascript using the script delimiters 
Block 5 - Straight HTML - After theCode Block 
Block 4 - SCRIPT LANGUAGE=VBScript RUNAT=Server</PRE>
<P>The thing to remember:there is no guaranteed execution order for code inside script blocks.  Note that the language opposite to your default gets called, then comes the HTML and script delimiters in the order you expect, then the script block containing the default language.  However, even figuring out how it seems to work is dangerous, since it could very well change in any system updates or product revs.  
</P>
<P>The recommendation is to <b>only use procedures or functions inside script blocks, and call these functions from within your primary script,</b> which gives control to you -- that is undoubtedly what you want.  An example of the way the above code could have been written to get the expected output is:
</P>
<PRE class="clsCode">
&lt;%@ Language=VBScript %&gt;
&lt;HTML&gt;
&lt;HEAD&gt;
&lt;META NAME=&quot;GENERATOR&quot; Content=&quot;Microsoft Visual 
  Studio 6.0&quot;&gt;
&lt;/HEAD&gt;
&lt;BODY&gt;

&lt;P&gt;&amp;nbsp;&lt;/P&gt;

Block 1 - Straight HTML - 
  Before the Code Block&lt;P&gt;

&lt;SCRIPT LANGUAGE=javascript RUNAT=Server&gt;
function WriteBlock2()
{   
   Response.Write (&quot;Block 2 - 
     SCRIPT LANGUAGE=javascript 
     RUNAT=Server&lt;P&gt; &quot;);
}
&lt;/SCRIPT&gt;

&lt;%
   WriteBlock2()
   Response.Write (&quot;Block 3 - 
     Javascript using the script delimiters&lt;P&gt;&quot;)
   WriteBlock4()
%&gt;

&lt;SCRIPT LANGUAGE=VBScript RUNAT=Server&gt;
Sub WriteBlock4()
   Response.Write (&quot;Block 4 - 
     SCRIPT LANGUAGE=VBScript 
     RUNAT=Server&lt;P&gt;&quot;)
End Sub

&lt;/SCRIPT&gt;
Block 5 - Straight HTML - 
  After theCode Block&lt;P&gt;
&lt;/BODY&gt;
&lt;/HTML&gt;</PRE>
<P>Thanks to Jeff Sandquist from Developer Support, who mentioned some of his customers were having problems with this.  He also provided some of the code to illustrate the issue.  I'll be sending him one of those highly coveted SBN T-shirts.
</P>
<!-- end of 090198.asp -->
<P><A HREF="morqa.htm#top" CLASS="clsBackTop"><IMG SRC="../../../workshop/graphics/top.gif" WIDTH="18" HEIGHT="8" BORDER="0" ALT="Back to top">Back to top</A></P>

<h2><a name="tips"></a>Tom's tips: ASP performance</h2>
<P>The best tip I can give you in a short space for improving your performance -- other than to try Viagra -- is to make sure you are using Active Server Pages technology in the right places.  Don't use ASP just so that all your pages will end with the same extension.  ASP is cool, but because it requires work on the server side, it doesn't come free.  If you have a fairly static page that isn't going to be customized, go ahead and leave it as HTML.</P>
<P>A good example might be a company presence on the Web. Often, the first page is the same for everyone and is changed by hand when merited. But the sub pages have things like shopping carts or news.  Make this first page an HTML page, and, with high volume, you'll notice the difference.  More importantly, your customers will notice.  After all, you want visitors' first experiences to be very snappy, or they'll probably go somewhere else.</P>

<!-- ARTICLE FOOTER START -->

<P><I><B>Tom Moran</B> is a program manager with Microsoft Developer Support and spends a lot of time hanging out with the Site Builder Network folks.  Outside of work, he practices kenpo (although sometimes necessary at work), tries out original recipes on his family (Lisa, Aidan, and Sydney), leads white-water trips, or studies tax law (boring, but true).</i>



<P>

<P>





<!-- DOCUMENT CONTENT END -->

</DIV>

<DIV CLASS="clsDocBody">
<HR SIZE="1" />
<P><I>Did you find this article useful? Gripes? Compliments? Suggestions for other articles? <A TITLE="Go ahead. Make our day! Send us your thoughts." HREF="../../../sitebuilder/pg05226.htm" TARGET="_top">Write us!</A></I></P>
<P ID="pBackTop"><A HREF="morqa.htm#top" CLASS="clsBackTop"><IMG SRC="../../../workshop/graphics/top.gif" WIDTH="18" HEIGHT="8" BORDER="0" ALT="Back to top">Back to top</A></P>

<P CLASS="clsIncCpyRt">

</P>

&copy; <A CLASS="clsIncCpyRt" HREF="http://www.microsoft.com/misc/cpyright.htm" TARGET="_top">1998 Microsoft Corporation. All rights reserved. Terms of use</A>.

<P>&nbsp;</P>
</DIV>
<SCRIPT LANGUAGE="JavaScript"><!--

function CheckToTop()
{
var eBody = document.body;
if (eBody.scrollHeight > eBody.offsetHeight) pBackTop.style.display = 'block';
}

//--></SCRIPT>

<DIV ID="divMenu1" CLASS="clsMenu" ONMOUSEOVER="Menu_hover();" ONMOUSEOUT="Menu_hover();" ONCLICK="Menu_click();">
<DIV expURL="../../../sitebuilder/magazine/default.htm">Magazine Home</DIV>
<DIV expURL="../../../sitebuilder/magazine/jane.htm">Ask Jane</DIV>
<DIV expURL="../../../sitebuilder/magazine/dude.htm">DHTML Dude</DIV>
<DIV expURL="../../../sitebuilder/magazine/xml.htm">Extreme XML</DIV>
<DIV expURL="../../../sitebuilder/magazine/starters.htm">For Starters</DIV>
<DIV expURL="../../../sitebuilder/magazine/hess.htm">More or Hess</DIV>
<DIV expURL="../../../sitebuilder/magazine/server.htm">Servin' It Up</DIV>
<DIV expURL="../../../sitebuilder/magazine/site.htm">Site Lights</DIV>
<DIV expURL="../../../sitebuilder/magazine/webmen.htm">Web Men Talking</DIV>
</DIV>
<DIV ID="divMenu2" CLASS="clsMenu" ONMOUSEOVER="Menu_hover();" ONMOUSEOUT="Menu_hover();" ONCLICK="Menu_click();">
<DIV expURL="http://www.microsoft.com/sbnmember/default.asp">Member Community Home</DIV>
<DIV expURL="http://www.microsoft.com/sbnmember/freebies/default.asp">Benefits: Freebies &amp; Discounts</DIV>
<DIV expURL="http://www.microsoft.com/sbnmember/promote/default.asp">Benefits: Promote Your Site</DIV>
<DIV expURL="http://www.microsoft.com/sbnmember/connect/default.asp">Benefits: Connect with Your Peers</DIV>
<DIV expURL="http://www.microsoft.com/sbnmember/glance-lev.asp">Benefits at a Glance</DIV>
<DIV expURL="http://www.microsoft.com/sbnmember/osig/default.asp">Online Special-Interest Groups</DIV>
<DIV expURL="http://www.microsoft.com/sbnmember/levels/member.asp">Your Membership</DIV>
<DIV expURL="http://www.microsoft.com/sbnmember/freebies/stores.asp">SBN Stores</DIV>
<DIV expURL="http://www.microsoft.com/sbnmember/apply/registration.asp">Join Now</DIV>
</DIV>
<DIV ID="divMenu3" CLASS="clsMenu" ONMOUSEOVER="Menu_hover();" ONMOUSEOUT="Menu_hover();" ONCLICK="Menu_click();">
<DIV expURL="../../../workshop/default.htm">Workshop Home</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/workshop/essentials/default.htm">Essentials</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/workshop/delivery/default.htm">Content &amp; Component Delivery</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/workshop/components/default.htm">Component Development</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/workshop/database/default.htm">Data Access &amp; Databases</DIV>
<DIV expURL="../../../workshop/design/default.htm">Design</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/workshop/author/default.htm">DHTML, HTML &amp; CSS</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/xml/default.htm">Extensible Markup Language (XML)</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/workshop/languages/default.htm">Languages &amp; Development Tools</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/workshop/messaging/default.htm">Messaging &amp; Collaboration</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/workshop/networking/default.htm">Networking, Protocols &amp; Data Formats</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/workshop/browser/default.htm">Reusing Browser Technology</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/workshop/security/default.htm">Security &amp; Cryptography</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/workshop/server/default.htm">Server Technologies</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/workshop/imedia/default.htm">Streaming &amp; Interactive Media</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/workshop/management/default.htm">Web Content Management</DIV>
<DIV expURL="../../../workshop/index/default.htm">Workshop Index</DIV>
</DIV>
<DIV ID="divMenu4" CLASS="clsMenu" ONMOUSEOVER="Menu_hover();" ONMOUSEOUT="Menu_hover();" ONCLICK="Menu_click();">
<DIV expURL="../../../gallery/default.htm">Tools &amp; Samples Home</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/gallery/tools/default.htm">Tools</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/gallery/samples/default.htm">Samples, Headers, Libs</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/gallery/images/default.htm">Images</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/gallery/sounds/default.htm">Sounds</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/gallery/stylesheets/default.htm">Style Sheets</DIV>
<DIV expURL="http://www.microsoft.com/typography/fontpack/win.htm">Web Fonts</DIV>
</DIV>
<DIV ID="divMenu5" CLASS="clsMenu" ONMOUSEOVER="Menu_hover();" ONMOUSEOUT="Menu_hover();" ONCLICK="Menu_click();">
<DIV expURL="../../../devtraining/default.htm">Training Home</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/devtraining/seminars/default.htm">SBN Live Seminars</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/devtraining/chat/default.htm">SBN Live Chats</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/devtraining/atec.htm">Courses</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/devtraining/peer/default.htm">Peer Support</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/devtraining/mastering.htm">CD-ROM Training</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/devtraining/books_kits.htm">Books & Training Kits</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/devtraining/mscert/default.htm">Certification</DIV>
</DIV>
<DIV ID="divMenu6" CLASS="clsMenu" ONMOUSEOVER="Menu_hover();" ONMOUSEOUT="Menu_hover();" ONCLICK="Menu_click();">
<DIV expURL="../../../sitebuilder/default.htm">SBN Home</DIV>
<DIV expURL="../../../sitebuilder/siteinfo/newtosite.htm">New to SBN?</DIV>
<DIV expURL="../../../sitebuilder/whatsnew.htm">What's New on SBN</DIV>
<DIV expURL="../../../sitebuilder/siteinfo/sitemap.htm">Site Map</DIV>
<DIV expURL="http://www.microsoft.com/isapi/gosearch.asp?TARGET=/dev/web/default.asp">Site Search</DIV>
<DIV expURL="../../../sitebuilder/siteinfo/glossary/default.htm">Glossary</DIV>
<DIV expURL="../../../sitebuilder/write-us.htm">Write Us</DIV>
<DIV expURL="../../../sitebuilder/siteinfo/about.htm">About This Site</DIV>
</DIV>
<SCRIPT LANGUAGE="JavaScript" SRC="../../../sitebuilder/shared/js/navbar.js"></SCRIPT> 
<SCRIPT LANGUAGE="JavaScript" SRC="../../../sitebuilder/shared/js/navlinks.js"></SCRIPT>


</BODY>
</HTML>
