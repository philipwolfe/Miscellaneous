
<HTML>
<HEAD>


<TITLE>SBN Server: Web Job Classifieds Site Technical Architecture</TITLE>

<META NAME="Description" CONTENT="15 Seconds Job Classifieds Technical Architecture" />
<META NAME="Keywords" CONTENT="Web Job Classifieds, architecture of classifieds site" />
<META NAME="Robots" CONTENT="All" />

<META NAME="Author" CONTENT="Wayne Berry" />
<META NAME="Posted" CONTENT="" />
<META NAME="Updated" CONTENT="07/27/1998" />

<META NAME="MS.LOCALE" CONTENT="EN-US" />
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1" />

<LINK REL="stylesheet" TYPE="text/css" HREF="../../../sitebuilder/shared/css/navbar.css" />
<LINK REL="stylesheet" TYPE="text/css" HREF="../../../sitebuilder/shared/css/ie4-wks.css" />


<SCRIPT LANGUAGE="JavaScript"><!--

// -----------------------------------------------------------
// Client-side BrowserData constructor
// Populated using data from server-side oBD object to avoid redundancy
// -----------------------------------------------------------

function BrowserData()
{
this.userAgent = "Mozilla/4.0 (compatible; MSIE 4.01; Windows NT)";
this.browser = "MSIE";
this.majorVer = "4";
this.minorVer = "01";
this.betaVer = 0;
this.platform = "NT";
this.getsNavBar = true;
this.doesActiveX = true;

}
var oBD = new BrowserData();

//--></SCRIPT>

<SCRIPT LANGUAGE="Javascript"><!--

// -----------------------------------------------------------
// window_load()
// Container function for load.
// -----------------------------------------------------------

function window_load()
{
if (oBD.getsNavBar)
{
if ("function" == typeof(InitNavLinks)) InitNavLinks();
if ("function" == typeof(CheckToTop)) CheckToTop();
}
}
window.onload = window_load;

//--></SCRIPT>

<SCRIPT LANGUAGE="JavaScript"><!--

  function showSample(sURL) {
    sFeatures = "width=520,height=400,left=10,top=10,toolbar=0,statusbar=0,scrollbars=1,resizable=1";
    newWin = window.open (sURL, "_blank", sFeatures);
    return false;
  }

//--></SCRIPT>


</HEAD>

<BODY TOPMARGIN="0" LEFTMARGIN="0" MARGINHEIGHT="0" MARGINWIDTH="0" BGCOLOR="#FFFFFF">


<TABLE WIDTH="100%" CELLPADDING="0" CELLSPACING="0" BORDER="0">
<TR>
<TD ROWSPAN="2" WIDTH="460" VALIGN="top"><NOBR><A HREF="http://www.microsoft.com/" TARGET="_top"><IMG SRC="../../../library/images/gifs/toolbar/home.gif" WIDTH="103" HEIGHT="21" ALT="Microsoft Home" BORDER="0"></A><A HREF="http://www.microsoft.com/PRODUCTS/DEFAULT.asp?DIVISIONID="10"" TARGET="_top"><IMG SRC="../../../library/images/gifs/toolbar/prod.gif" WIDTH="81" HEIGHT="21" ALT="products" BORDER="0"></A><A HREF="http://www.microsoft.com/search/default.asp" TARGET="_top"><IMG SRC="../../../library/images/gifs/toolbar/search.gif" WIDTH="68" HEIGHT="21" ALT="search" BORDER="0"></A><A HREF="http://www.microsoft.com/ISAPI/GOSUPPORT.asp?TARGET=/SUPPORT/" TARGET="_top"><IMG SRC="../../../library/images/gifs/toolbar/support.gif" WIDTH="74" HEIGHT="21" ALT="support" BORDER="0"></A><A HREF="http://www.microsoft.com/referral/default.asp" TARGET="_top"><IMG SRC="../../../library/images/gifs/toolbar/shop.gif" WIDTH="55" HEIGHT="21" ALT="shop" BORDER="0"></A><A HREF="http://www.microsoft.com/ISAPI/GOREGWIZ.asp?TARGET=/REGWIZ/REGWIZ.asp" TARGET="_top"><IMG SRC="../../../library/images/gifs/toolbar/write.gif" WIDTH="78" HEIGHT="21" ALT="Write Us" BORDER="0"></A><IMG SRC="../../../library/images/gifs/toolbar/spacer.gif" WIDTH="1" HEIGHT="21" ALT="" BORDER="0"></NOBR></TD>
<TD BGCOLOR="#000000" WIDTH="100%" HEIGHT="20">&nbsp;</TD>
<TD ROWSPAN="2" WIDTH="91" ALIGN="right" VALIGN="top"><A HREF="http://www.microsoft.com/" TARGET="_top"><IMG SRC="../../../library/images/gifs/toolbar/msft.gif" WIDTH="91" HEIGHT="21" ALT="Microsoft Home" BORDER="0"></A></TD>
</TR>
<TR>
<TD COLSPAN="3" BGCOLOR="#FFFFFF" WIDTH="100%" HEIGHT="1"></TD>
</TR>
</TABLE>

<TABLE ID="tblNavBar" BORDER="0" CELLPADDING="0" CELLSPACING="0">
<TR VALIGN="top">
<TD CLASS="clsSBNLogo" TITLE="SBN Home" HEIGHT="34" WIDTH="90"><A HREF="/sitebuilder/default.htm" TARGET="_top" expNoTOC="true"><IMG HEIGHT="34" WIDTH="90" BORDER="0" SRC="../../../sitebuilder/shared/navbar/graphics/sbnbrand2.gif" ALT="SBN Home" /></A></TD>
<TD CLASS="clsNavBarItem" expItemNum="1">Magazine<BR><IMG HEIGHT="4" WIDTH="7" BORDER="0" SRC="../../../sitebuilder/shared/navbar/graphics/arrow.gif"></TD>
<TD>&nbsp;|&nbsp;</TD>
<TD CLASS="clsNavBarItem" expItemNum="2">Community<BR><IMG HEIGHT="4" WIDTH="7" BORDER="0" SRC="../../../sitebuilder/shared/navbar/graphics/arrow.gif"></TD>
<TD>&nbsp;|&nbsp;</TD>
<TD CLASS="clsNavBarItem" expItemNum="3">Workshop<BR><IMG HEIGHT="4" WIDTH="7" BORDER="0" SRC="../../../sitebuilder/shared/navbar/graphics/arrow.gif"></TD>
<TD>&nbsp;|&nbsp;</TD>
<TD CLASS="clsNavBarItem" expItemNum="4">Tools&nbsp;&amp;&nbsp;Samples<BR><IMG HEIGHT="4" WIDTH="7" BORDER="0" SRC="../../../sitebuilder/shared/navbar/graphics/arrow.gif"></TD>
<TD>&nbsp;|&nbsp;</TD>
<TD CLASS="clsNavBarItem" expItemNum="5">Training<BR><IMG HEIGHT="4" WIDTH="7" BORDER="0" SRC="../../../sitebuilder/shared/navbar/graphics/arrow.gif"></TD>
<TD>&nbsp;|&nbsp;</TD>
<TD CLASS="clsNavBarItem" expItemNum="6">Site&nbsp;Info<BR><IMG HEIGHT="4" WIDTH="7" BORDER="0" SRC="../../../sitebuilder/shared/navbar/graphics/arrow.gif"></TD>
<TD WIDTH="100%"></TD>
</TR>
</TABLE>


<TABLE ID="tblNavLinks" CLASS="clsNavLinks" CELLPADDING="0" CELLSPACING="0" BORDER="0" WIDTH="100%">
<TR>
<TD COLSPAN="2" HEIGHT="8"><IMG WIDTH="1" HEIGHT="8" SRC="../../../sitebuilder/shared/graphics/trans.gif"></TD>
<TD ROWSPAN="2"><A HREF="../../../workshop/default.htm" TARGET="_top"><IMG ALIGN="right" HEIGHT="30" WIDTH="106" BORDER="0" ALT="Click to return to the Workshop home page" SRC="../../../workshop/graphics/wrkbrand2.gif" /></A><BR /></TD>
</TR>
<TR>
<TD ROWSPAN="2">
<A HREF="../../../workshop/server/pg00164.htm"><IMG HEIGHT="32" WIDTH="31" HSPACE="25" BORDER="0" ALT="Click to return to the Server Technologies home page" SRC="../../../workshop/graphics/icons//server.gif" /></A>
</TD>
<TD>
<TABLE CELLPADDING="3" CELLSPACING="0" BORDER="0">
<TR>

<TD><A ID="lnkShowImg" HREF="../../../workshop/server/toc.htm" TARGET="_top"><IMG ID="imgShow" CLASS="clsLeftMenu" HEIGHT="15" WIDTH="18" BORDER="0" SRC="../../../workshop/graphics/icons/nl-show-0.gif" ALT="" /></A><BR></TD>
<TD NOWRAP><A ID="lnkShowText" CLASS="clsLeftMenu" HREF="../../../workshop/server/toc.htm" TARGET="_top">show toc</A> &nbsp;&nbsp; </TD>

<TD><A ID="lnkSyncImg" HREF="../../../workshop/pg01295.htm#/workshop/server/scenario/classtech.htm" TARGET="_top"><IMG ID="imgSync" CLASS="clsLeftMenu" HEIGHT="15" WIDTH="18" BORDER="0" SRC="../../../workshop/graphics/icons/nl-sync-0.gif" ALT="" /></A><BR></TD>
<TD NOWRAP><A ID="lnkSyncText" CLASS="clsLeftMenu" HREF="../../../workshop/pg01295.htm#/workshop/server/scenario/classtech.htm" TARGET="_top">sync toc</A> &nbsp;&nbsp; </TD>

<TD><A ID="lnkSearchImg" HREF="http://www.microsoft.com/isapi/gosearch.asp?TARGET=/dev/web/default.asp" TARGET="_top"><IMG ID="imgSearch" CLASS="clsLeftMenu" HEIGHT="15" WIDTH="18" BORDER="0" SRC="../../../workshop/graphics/icons/nl-search-0.gif" ALT="" /></A><BR></TD>
<TD NOWRAP><A ID="lnkSearchText" CLASS="clsLeftMenu" HREF="http://www.microsoft.com/isapi/gosearch.asp?TARGET=/dev/web/default.asp" TARGET="_top">search</A> &nbsp;&nbsp; </TD>

<TD><A ID="lnkIndexImg" HREF="../../../workshop/index/pg00001.htm"><IMG ID="imgIndex" CLASS="clsLeftMenu" HEIGHT="15" WIDTH="18" BORDER="0" SRC="../../../workshop/graphics/icons/nl-index-0.gif" ALT="" /></A><BR></TD>
<TD NOWRAP><A ID="lnkIndexText" CLASS="clsLeftMenu" HREF="../../../workshop/index/pg00001.htm">index</A> &nbsp;&nbsp; </TD>

</TR>
</TABLE>
</TD>
</TR>
<TR>
<TD COLSPAN="2" WIDTH="100%">
<TABLE CELLPADDING="2" CELLSPACING="0" BORDER="0">
<TR>
<TD>&nbsp;</TD>
</TR>
</TABLE>
</TD>
</TR>
</TABLE>

<BR CLEAR="all" />
<DIV CLASS="clsBucketBranch"><A HREF="../../../workshop/pg00004.htm" TARGET="_top">Workshop</A>&nbsp;&nbsp;|&nbsp;&nbsp;<A HREF="../../../workshop/pg01295.htm#/workshop/server/pg00164.htm" TARGET="_top">Server Technologies</A></DIV>

<DIV CLASS="clsDocBody">

<!-- DOCUMENT CONTENT START -->

<H1><A NAME="top2" IDX_TYPE="sbngen" IDX_CONCEPT="stopindex; Web Job Classifieds technical architecture">15 Seconds Job Classifieds Technical Architecture</A></H1>
<HR SIZE="1" />
<P>Wayne Berry<BR>Editor, 15 Seconds
<P>April 14, 1998
<P><a href="classtech.zip"><IMG SRC="../../../sitebuilder/graphics/icodownl.gif" WIDTH=16 HEIGHT=20 BORDER=0 ALT="Download"> Download this document in Microsoft Word (.DOC) format (zipped, 15.8K)</a>.
<a name="top"></a><P><b>Contents</b>
<BR> <A HREF="classtech.htm#topic1">Introduction</A>
<BR> <A HREF="classtech.htm#topic2">Welcome Screen</A>
<BR> <A HREF="classtech.htm#topic3">Main Page</A>
<BR> <A HREF="classtech.htm#topic4">Navigation Bar</A>
<BR> <A HREF="classtech.htm#topic4.5">Regions and Categories</A>
<BR> <A HREF="classtech.htm#topic5">Columns</A>
<BR> <A HREF="classtech.htm#topic6">New Ads</A>
<BR> <A HREF="classtech.htm#topic7">New Postings</A>
<BR> <A HREF="classtech.htm#topic8">Removing Postings</A>
<BR> <A HREF="classtech.htm#topic8.5">Search</A>
<BR> <A HREF="classtech.htm#topic9">Database Design</A>
<BR> <A HREF="classtech.htm#topic10">Summary</A>
<P>
<h2><A NAME="topic1" IDX_CONCEPT="stopindex">Introduction</A>
</h2>
<P>This article describes the technical design and development of the components that make up the 15 Seconds Job Classifieds site.  I'll discuss the functionality, the JScript&#153;, Visual Basic&#174; Scripting Edition (VBScript), Active Server Pages (ASP), Dynamic HTML (DHTML), and the database design used for the functioning Web site.  The downloadable classifieds site code is thoroughly commented so you can easily find the algorithms and functions described here. This documentation along with the  <A HREF="classinstall.htm">installation documentation</A> provide what you need to download, install, and customize the classifieds site code for your own use. For an overview of site features, see  <A HREF="classovw.htm">15 Seconds Job Classifieds Site Features</A>.
<P>
<h2><A NAME="topic2"></A>Welcome Screen
</h2>
<P>When users first enter the site, they are presented with a welcome screen that displays the welcome text, located in welcome_text.asp, and are asked to choose a region for which they want to see ads.  If they have a browser that supports DHTML, they are presented with a modal dialog box that freezes the underlying screen until they choose a region.  If they are not able to run DHTML they are redirected to html_welcome.asp, and once they have selected a region they go back the main ad page, default.asp.
<P>The Modal dialog box is created with the <A HREF="classtechex.htm" TARGET="_blank"
    ONCLICK="return showSample('/workshop/server/scenario/classtechex.htm')">following statement</a> that appears in popup_jscript.asp.
<P>

<P>The XSession component is used to store a flag indicating whether they have seen the welcome page.  XSession is a hybrid of the Session object, storing a name value pair for a user on the hard drive.
<P>Selecting a region from the welcome screen is an important start to a user's interaction with the site.  Without the ability to select a region, the user would be presented with all ads -- a selection that would appear too large for an introductory page.
<P> <A HREF="classtech.htm#top" CLASS="clsBackTop"><IMG SRC="../../../workshop/graphics/top.gif"  WIDTH="18" HEIGHT="8" BORDER="0" ALT="Top">Back to top</A>

<h2><A NAME="topic3"></A>Main Page
</h2>
<P>The classifieds site has only one page, which always displays the same layout.  However, the ads displayed within the layout of this main page change according to the user's selection of categories and regions.  Other pages appear in pop-up windows from the main page; however, the user's primary view is of the main page.
<P>Default.asp contains the layout of the site.  It dictates which arrangement of ads to display based on user input, by calling the correct column function in columns.asp.  It also determines which browser the user has and fills in the correct navigation bar depending on whether that browser supports DHTML.  It also displays the header and footer, and the outside table.
<P>
<h3>Pop-Up Windows
</h3>
<P>Three pages display as pop-up windows:  ad.asp, newpost.asp, and popup_search.asp.
<P><b>ad.asp</b>
<P>Displays the contact information for a particular advertisement.  The user gets this window if they click the ad from default.asp.  Removing the contact information from the description makes for a cleaner appearance on the main page. It also enables the user to print just that window, with just the ad that interests them.  Secondly, the pop-up window prevents crawlers from traversing the Web site and gathering e-mail addresses for bulk e-mail purposes.
<P><b>newpost.asp</b>
<P>Enables the user to post an advertisement.  The user can get this window from the View drop-down menu.  See the section on  <A HREF="classtech.htm#topic7">posting new ads</A> in this article.
<P><b>popup_search.asp</b>
<P>Enables the user to search the classifieds for particular keywords in the description or the title.  Unlike the other windows, searching directly affects default.asp.  Default.asp is refreshed with the results of the search.
<P>
<h3>Active Desktop
</h3>
<P>By clicking the Active Desktop&#153; image at the bottom of the page, Internet Explorer 4.0 users can add a &quot;Job of the Day&quot; Desktop item to their desktop.  This Desktop item reloads to display a new job every night.  To create an Active desktop item, we create a channel definition file  (CDF) called activedesktop.cdx and a Web page to display within it called activedesktop.asp.
<P><b>activedesktop.cdx</b>
<P>A dynamic channel file that substitutes the Web site name into the XML.  A CDX file is the same as a CDF file, except that a CDX file is processed by the Active Server the same as an ASP file.
<P><b>activedesktop.asp</b>
<P>Displays a new job every day by selecting a random job from the database. Only jobs within the user's selected regions are displayed for that user.
<P>
<h3>Supporting Files
</h3>
<P>Besides default.asp, the Active desktop files, and the pages used for pop-up windows, there are several included files.  Included files enable the programmer to change a setting or code on one page, and have it affect all the pages that include that file.
<P>For security reasons, these pages have been given .asp extensions.  For example, sql.asp contains the log on and password to the SQL Server membership database that the site uses.  We have included this page from every other page, enabling us to change the password in one spot while affecting all the pages.  If a request is made for sql.asp, a blank page will be returned, because all it does is set some server-side constants.  However, if we named the page sql.inc, requesting the page would display the password to the SQL Server.  The difference is that the Active Server interrupts .asp pages, and .inc pages are just served as text.  For this reason we have used the .asp extension with all the pages we include.
<P>These pages are never called directly, but are included:
<P><b>ad_display.asp</b>
<P>Displays the advertising information in a uniform manner, including the contact information.  This file is included from both done.asp and ad.asp.
<P><b>ad_read.asp</b>
<P>Reads the advertising information from the database. This file is included from both done.asp and ad.asp.
<P><b>css.asp</b>
<P>Contains all the cascading style sheets (CSS).
<P><b>popup_jscript.asp</b>
<P>Contains all the client-side JScript that deals with the pop-up windows.
<P><b>sql.asp</b>
<P>Contains the SQL Server DNS, log on, and password.
<P><b>global.asp</b>
<P>Different than global.asa. Contains all the global variables used to configure the site.  Changing variables in this file will change the look and feel of the site.
<P><b>columns.asp</b>
<P>Contains functions and subroutines for displaying the columns of ads.  These functions and subroutines are called from default.asp according to the configuration of ads to be displayed.  For more information, see  <A HREF="classtech.htm#topic5">Columns</A>.
<P><b>dhtml_navigation.asp</b>
<P>This file and all the other files starting with dhtm_*.asp are used to create the DHTML navigation bar that is seen when using the site with Internet Explorer 4.0 or later.
<P><b>html_naviagation.asp</b>
<P>This file and all the other files starting with html_*.asp are used to create the HTML navigation that is used with all browsers that don't support DHTML.
<P><b>footer.asp</b>
<P>Contains the copyright information for the site.  The footer is used by activedesktop.asp and default.asp.
<P><b>buttons.asp</b>
<P>Contains the information for the buttons displayed at the bottom of the page, including the Internet Explorer button and the Active Desktop button.
<P><b>header.asp</b>
<P>The header for the site, including the site brand and the title.  You will need to make changes to header.asp for your own customized site.
<P><b>done.asp</b>
<P>The last page displayed in the posting process. It displays the ad about to be posted and enables the user to cancel or approve the posting.  Having this as a separate page prevents multiple postings from refreshing the page. In other words, refreshing done.asp doesn't create multiple posts to the site because this page is not responsible for post the data to the database.  This is a common user interface error that we avoided by creating an additional page to which the working page redirects.
<P><b>newpost_text.asp</b>
<P>The text that gets included with the new postings.  Separating it from newpost.asp allows for easy changes.
<P><b>welcome_text.asp</b>
<P>The text that gets included with the welcome screen.  It is included in both html_welcome.asp and dhtml_welcome.asp.  This enables the Web administrator to change the text in one spot and have it changed in both pages.
<P><b>popup_legal.asp</b>
<P>Displays the legal text for the site.  Note that this is only a pop-up window when working with Internet Explorer 4.0 or later; otherwise it is displayed as a page.

<P> <A HREF="classtech.htm#top" CLASS="clsBackTop"><IMG SRC="../../../workshop/graphics/top.gif"  WIDTH="18" HEIGHT="8" BORDER="0" ALT="Top">Back to top</A>

<h2><A NAME="topic4"></A>Navigation Bar
</h2>
<P>There really are two navigation bars: one for browsers supporting DHTML and one for browsers that do not.  The DHTML navigation bar is a rich interactive toolbar that mimics the Microsoft Windows&#174; interface navigation bar, using DHTML and JScript to react to user clicks.  Because the navigation bar uses drop-down menus to store the categories and regions, there is more screen space available to view ads.  The HTML navigation bar, used when DHTML is not supported, runs in the left-hand column instead of a column of ads.
<P>Global.asp detects which browser is requesting the page using the <b>BrowserType</b> object that comes with the Internet Information Server.  If global.asp sees that the browser is Internet Explorer 4.0, it sets the <i>bDHTMLNavigation</i> variable to <b>True</b>.  Default.asp uses this variable to determine which type of navigation to display.  If DHTML is not supported, a column is removed from ads in the <b>Column</b>s function in dhtml_functions.asp.  One less column makes room for the navigation bar on the left-hand side.
<P>
<h3>Handling Empty Pages
</h3>
<P>Both types of navigation will display only subcategories that contain postings.  This prevents the user from navigating to a page that is blank. They also only display categories that contain subcategories.  Because many users can access the site at the same time and make postings at the same time, the navigation bars can appear to change during the course of the user's session.
<P>
<h3>DHTML Navigation
</h3>
<P>The DHTML navigation consists of four menus: View, Region, Categories, and More Info.  Each menu drops down to display a list of selections, much like menu bars for a Windows application (see Figure 1).  Each drop-down menu is contained in a different file: dhtml_nav_view.asp, dhtml_nav_category.asp, dhtml_nav_region.asp, and dhtml_nav_more.asp.  These files make database queries and call functions in dhtml_functions.asp to create the drop-down menus.  Supporting JScript is located in dhtml_jscript.asp.  Most of the JScript handles the coloring of the navigation bar from the client side as the mouse travels over the menus.  Here is a beakdown of the JScript functions:
<P>
<b>doMenu
</b>
<P>Handles mouse clicks for displaying the drop-down menus.  <b>doMenu</b> sets a timer that calls <b>ShowMenu</b> and <b>ShowSubMenu</b>.  These two functions are used to make the menu appear as if it is expanding, instead of instantly appearing.
<P>
<b>ShowMenu
</b>
<P>See <b>doMenu</b>.
<P><b>ShowSubMenu</b>
<P>See <b>doMenu</b>.
<P><b>mouseoverHandler</b>
<P>Handles special cases when the mouse is dragged over certain CSS classes.  This is where the coloring of the drop-down menus takes place, and the &quot;lifting&quot; of the menu buttons.
<P><b>mouseoutHandler</b>
<P>Handles special cases when the mouse leaves certain CSS classes.  Usually the original colors are restored.
<P>Default.asp sends the JScript contained in dhtml_jscript.asp down to the client if DHTML is not supported.  This prevents unnecessary compiling on the client for menu functions that do not appear.
<P>
<h3>HTML Navigation
</h3>
<P>The HTML navigation is provided for browsers that do not support DHTML.  The HTML navigation reduces the number of columns displayed by one, and displays the navigation in a special column on the left.  This reduces the amount of viewable ads.  There is no supporting client-side JScript for the HTML navigation.
<P>The HTML navigation consists of four sections, each one containing the same information as a drop-down menu in the DHTML.  These sections are in html_nav_category.asp, html_nav_more.asp, html_nav_region.asp, and html_nav_view.asp.  Each of these files is included in html_navigation.asp.
<P> <A HREF="classtech.htm#top" CLASS="clsBackTop"><IMG SRC="../../../workshop/graphics/top.gif"  WIDTH="18" HEIGHT="8" BORDER="0" ALT="Top">Back to top</A>

<h2><A NAME="topic4.5"></A>Regions and Categories
</h2>
<P>On the first visit to the site, all the regions are selected and the user sees all ads that have been posted to that particular category.  If the user wants, she can uncheck regions that do not interest her.  The 15 Seconds Job Classifieds has global regions; however, the downloadable classifieds site code can be customized to have whatever regions you want.  For instance, if you are advertising apartments in a particular city, you might want to divide the city into sections: North Seattle, West Seattle, and the Eastside.  You can customize the regions by changing the entries in the region table.  The downloadable code comes with the global regions that the 15 Seconds Job Classifieds uses.
<P><IMG SRC="figure001.gif"  WIDTH="362" HEIGHT="171" BORDER="0" ALT="Up">
<P><b>Figure 1. Selecting a region</b>
<P>The user's region selection needs to be stored, because it needs to persist across multiple pages for the lifetime of the session. In the 15 Seconds Job Classifieds site, the region selection is stored in an object called XSession. XSession is like the built-in Session object that comes with the Internet Information Server (IIS), except it allows Web developers more flexibility. It has the ability to store information without expiration and the ability to preserve Session State across multiple machines on a Web farm.  XSession enables the reader to return days later and the site will still remember the user's selection.  It also enables big sites, like the 15 Seconds Job Classifieds, to be hosted on multiple Web servers.
<P>The classifieds are divided into categories and subcategories, called sections and subsections in the database.  These divisions enable individuals looking for all the ads about a particular topic to narrow their selection.  The 15 Seconds Job Classifieds site has ads for employment opportunities using Microsoft Internet solutions.  However, you can modify the section and subsection table to change these categories and subcategories.
<P>Each category is associated with a number, usually in the hundreds.  These numbers are used to sort the categories, because integer sorting is much faster in SQL Server than sorting a string.  Secondly, the numbers enable the Webmaster to determine the order in which the categories are presented.  This technique is similar to that of major newspapers.
<P>Each subcategory is also associated with a number that falls within the range of its parent category.  For instance, the subcategory numbered 420 would have a parent category of 400.  This is also like the newspaper's layout, and is used for quick sorting of the categories.
<P>Category and subcategory numbers are presented to the user as a delimiter both on the navigation bar and within the display of the ads.
<P> <A HREF="classtech.htm#top" CLASS="clsBackTop"><IMG SRC="../../../workshop/graphics/top.gif"  WIDTH="18" HEIGHT="8" BORDER="0" ALT="Top">Back to top</A>

<h2><A NAME="topic5"></A>Columns
</h2>
<P>One of the  <A HREF="classovw.htm">goals of the Web site</A> is to arrange the ads so that there is a minimal amount of white space at the bottom of each column; much like a printed newspaper.  The columns.asp file contains subroutines that arrange the columns.
<P>The algorithm is based on the number of characters that the ad contains and the number of characters that can be evenly displayed in each column.  The column function first iterates though all the ads that are to be displayed, counting the number of characters.  Inserted are delimiters for categories and subcategories.  Once the number of characters is calculated, the number of characters per column can be determined based on the number of desired columns.  The number of columns and the column width in pixels can be set in the global.asp file.  <b>glColumns</b> is the number of columns and <b>glColumnWidth</b> is the width of those columns in pixels.
<P>Once the characters per column are determined, the second stage of the function begins.  Ads are arranged by first inserting the maximum number of characters that will fit in the column.  Near the bottom, the minimum number of characters that will fit are used to fill the column as evenly as possible.  Once the column is filled, a new column is created and it is filled.
<P>The algorithm is adjusted to make sure that there is always one ad in a column.  In cases where there is only one ad, the category, subcategory, and the ad all appear in one column, instead of each in an individual column.
<P>If a subcategory will not all fit in one column, the algorithm inserts an extra subcategory header at the beginning of the next column.  This is much like the newspaper, enabling readers to scan the top headers looking for the correct subcategory.
<P>If the ad has an entry in the <b>Post_Graphic</b> field of the post table, the graphic and its link are inserted into the column instead of the ad text.  This allows the Webmaster to insert graphics into the ad that work like banners.  Users clicking the graphic are sent to the advertiser's site.  The graphics must be the same size in width as the column, that is, <b>glColumnWidth</b> pixels.  If it is not the right size, it adjusts to match the column width.
<P>
<h3><A NAME="FUNC"></A>Function Breakdown
</h3>
<P>The functions for creating the columns are in the columns.asp file.
<P>
<b>Columns
</b>
<P>The <b>Columns</b> subroutine is the main function that rearranges the columns.
<P>
<b>ColumnsBySubSection
</b>
<P>Calls the <b>Columns</b> subroutine after taking the passed-in subsection number and creating a SQL statement that will limit the columns displayed to just those within that subroutine.
<P>
<b>ColumnsByKeyWord
</b>
<P>Calls the <b>Columns</b> function after creating a SQL statement that will limit the ads displayed to those containing the keyword passed into <b>ColumnsByKeyWord</b>.  This subroutine is used to support the search.
<P>
<b>NewColumns
</b>
<P>Calls the <b>Columns</b> function after it figures out the newest advertisements to display.
<P>
<b>MaxAd
</b>
<P>Finds the biggest ad and returns an index to it.  The ad must be smaller than the <b>lCharacterCount</b> parameter passed in and be within the same subsection.
<P>
<b>MinAd
</b>
<P>Finds the smallest advertisement in the subsection.
<P>
<b>SwapAds
</b>
<P>Swaps two ads in both the <b>Insert</b> and <b>InsertType</b> arrays.
<P>
<b>Rearrange
</b>
<P>Finds the best possible fit for the column.  Called by the <b>Columns</b> subroutine after all the files have been read into the column array.
<P>
<b>UserPreferredRegions
</b>
<P>Returns a comma-delimited list of region IDs that can be used to limit the number of ads displayed in the columns.  The user prefers all the regions returned by <b>UserPreferredRegions</b>.  The <b>Columns</b> subroutine calls this function to limit the advertisements displayed to only the regions the user prefers.
<P> <A HREF="classtech.htm#top" CLASS="clsBackTop"><IMG SRC="../../../workshop/graphics/top.gif"  WIDTH="18" HEIGHT="8" BORDER="0" ALT="Top">Back to top</A>

<h2><A NAME="topic6"></A>New Ads
</h2>
<P>The average site loses about sixty percent of its traffic from the front page.  This means that users seeing the page are not interested enough to explore the site deeper.  This loss can be caused by imprecise marketing that attracts users who are not interested in the site.  In other cases, the front page does not load fast enough or is unattractive.  Both these issues are related to site design.
<P>When users first enter the 15 Seconds Job Classifieds site, they are presented with the newest ads the site has to offer.  The theory is that newer ads are better than older ads because older ads have been viewed previously.
<P>What is new is determined by the number of days the ad has been posted on the site.  This can be changed by adjusting the <b>glNewDays</b> parameter in the global.asp file.  However, this alone is not enough information to create an interesting first page.  If there were no new ads -- based on the <b>glNewDays</b> setting -- the first page would appear empty.
<P>To make sure that there are ads on the front page, the newest ads are displayed, starting with <b>glNewDays</b> and expanding until there are <b>glNewAdMin</b> ads by increasing the number of days considered new by <b>glNewDays</b>.  For example, if <b>glNewDays</b> equals 2 and there are no ads posting within this period, the range is expanded to 4.  If there is only one ad, less than <b>glNewAdMin</b>, the range is expanded to 6.  This happens until there is a least <b>glNewAdMin</b> ad available for display.
<P>This algorithm makes sure that the front page is always interesting to the reader and the returning reader.  Because XSession saves the reader's information across multiple visits, returning readers only see new ads within their region, which saves them the time of making the selections again.
<P> <A HREF="classtech.htm#top" CLASS="clsBackTop"><IMG SRC="../../../workshop/graphics/top.gif"  WIDTH="18" HEIGHT="8" BORDER="0" ALT="Top">Back to top</A>

<h2><A NAME="topic7"></A>New Postings
</h2>
<P>To post a new ad, a user can select Posting Window from the View menu.  The newpost.asp dialog appears asking her for information about the posting.  The instructions displayed at the top can be found in the newpost_text.asp file and should be changed based on the theme of the site.  When the user enters information into the form and presses the Post Ad button, the input is redirected to the newpost.asp page.  If the input is correct, the browser is redirected to done.asp.  Done.asp displays the information and enables the user to delete the advertisement or approve it.  If the user decides to not post the advertisement, they are redirected back to the newpost.asp page.
<P>The newpost.asp page relies heavily on the XCheck component to check the data and present the correct options.  For example, the information for all the states and the countries comes from internal XCheck collections.  XCheck is used to make sure the submissions are of the right length, they contain no profanity, and that the zip code, e-mail address, and user name is valid.  XCheck allows the posting to go live without site administrator intervention; it makes sure that the postings are correct.  Without Xcheck, someone would need to review each posting, removing the dynamic aspect of the site.
<P>When all the submitted data is checked and it appears correct, the data is written to the database in the post table.  There is a column for every field in the form.
<P>done.asp reads the data from the database and uses ad_read.asp to display the data exactly as the advertisement will appear.  Because ad_read.asp is used both in ad.asp and done.asp, there is no chance of the ad appearing differently.  If the user decides to delete the advertisement after viewing it, the ad gets deleted from the database.
<P>Note that the pop-up window closes itself. This is done by calling the <b>closeWindow</b> function located in popup_jscript.asp:
<P>
<PRE CLASS=clsCode>
&lt;SCRIPT LANGUAGE=&quot;JavaScript&quot;&gt;
 function doCloseWindow()
 {
  window.close();
 }
&lt;/SCRIPT&gt;
</PRE>
<P> <A HREF="classtech.htm#top" CLASS="clsBackTop"><IMG SRC="../../../workshop/graphics/top.gif"  WIDTH="18" HEIGHT="8" BORDER="0" ALT="Top">Back to top</A>

<h2><A NAME="topic8"></A>Removing Postings
</h2>
<P>Once the submitter approves the posting, there is no way for them to remove the posting.  Instead, a SQL stored procedure is used to remove all postings that are older than two weeks.  This gives the user peace of mind that the postings will not stay up there forever and removes them from the responsibility of deleting the ad.
<P> <A HREF="classtech.htm#top" CLASS="clsBackTop"><IMG SRC="../../../workshop/graphics/top.gif"  WIDTH="18" HEIGHT="8" BORDER="0" ALT="Top">Back to top</A>

<h2><A NAME="topic8.5"></A>Search
</h2>
<P>The search functionality enables the user to rearrange the classified ads in the main window via a separate pop-up window .  Ads that match the keywords are displayed to the user.  These are restricted to the region selection of the user.
<P><IMG SRC="figure002.gif"  WIDTH="406" HEIGHT="137" BORDER="0" ALT="Up">
<P>Figure 2. Pop-up search window</b>
<P> <A HREF="classtech.htm#top" CLASS="clsBackTop"><IMG SRC="../../../workshop/graphics/top.gif"  WIDTH="18" HEIGHT="8" BORDER="0" ALT="Top">Back to top</A>

<h2><A NAME="topic9"></A>Database Design
</h2>
<P>The database design was done with SQL Server, to insure that the site could support substantial levels of load.
<P>The Regions, Sections, and SubSections are in the database instead of being hard-coded into the pages.  This design gives the Webmaster the ability to customize the site to a theme other than job classifieds.  For example, the site could have classifieds for automobiles or apartments.  This technique also allows us to only show subsections that have postings in them, eliminating dead ends for the user.  Because the pages are dynamic and the database must be queried to create the menus, there is more server overhead in this design than one designed with static menus.
<P>The ad postings are also kept in the SQL Server database and must be queried for every page creation.  This enables the creation of customized pages for the user's region and selected category.  It also enables us to have postings automatically inserted into the pages and for them to be deleted every night.
<P>
<h3>Integer Sorting
</h3>
<P>As in a newspaper, each classifieds section was given a number, and that number has a range of subsections.  For example, the section number might be 400 and each subsection would be 401, 402, and so on.  Like a newspaper, each section and subsection has a description that defines what ads are in the sections.  However, when sorting the sections for display, the numbers are used because they sort the character-based names of the sections faster.  Integer-based sorting is considerably faster than text based sorting on SQL Server.
<P>
<h3>Table Design
</h3>
<P>There are four tables that make up the classifieds site: post, region, section, and subsection.
<P>
<h4>Post
</h4>
<P>The post tables hold all the ad information, including what region and subsection each ad is in.  Each row in the table is an ad that is associated, using the primary key, to a region and subsection.  In this design, an ad can only be in one region and one section.
<P>
<h4>Region
</h4>
<P>This is a lookup table with all the regions.  Adding regions to this table will enable users to post to those regions, creating ads in those regions.  There is a foreign key relationship between the post table and the region table, restricting you from deleting a region that has postings associated with it.
<P>
<h4>SubSection
</h4>
<P>This is a lookup table that holds all the subsections.  One row in this table represents each subsection.  Each subsection knows which section it is in.  For this reason, a subsection cannot exist in more than one section.  There is a foreign key relationship between the subsection table and the post table.  This prevents the deletion of a subsection when there is a posting in that subsection.
<P>
<h4>Section
</h4>
<P>This is a lookup table that holds all the sections, that is, categories.  One row in this table represents each major category.  There is a foreign key relationship between the sections and the subsections, this prevents the deletion of a section when there is a subsection that is related to it.
<P> <A HREF="classtech.htm#top" CLASS="clsBackTop"><IMG SRC="../../../workshop/graphics/top.gif"  WIDTH="18" HEIGHT="8" BORDER="0" ALT="Top">Back to top</A>

<h2><A NAME="topic10"></A>Summary
</h2>
<P>The downloadable classifieds site code provides you the power and flexibility to create classifieds sites with individual themes.  It is done in a minimal number of pages and leverages Microsoft technology to create a powerful user experience.
<P>See also the  <A HREF="classinstall.htm">downloadable classifieds site code</A> and the article on the  <A HREF="classtech.htm">15 Seconds Job Classifieds Technical Architecture</A>. If you are interested in SBN membership so you can access contact information on the site and post job openings, see the  <A HREF="http://www.microsoft.com/sbnmember/" TARGET="_top">SBN Membership home page</A> and the  <A HREF="http://www.microsoft.com/sbnmember/connect/jobads.asp" TARGET="_top">bumper page</A> that points to the 15 Seconds Job Classifieds for SBN Members.
<P><i><A HREF="http://www.15Seconds.com" TARGET="_top">15 Seconds</A> <IMG SRC="../../../sitebuilder/graphics/leave-ms.gif" WIDTH="33" HEIGHT="11" BORDER="0" ALT="Non-MS link"> is a free Internet resource for developers working with Microsoft Internet Solutions and product lines of <A HREF="http://www.signmeup.com" TARGET="_top">Sign Me Up Marketing</A> <IMG SRC="../../../sitebuilder/graphics/leave-ms.gif" WIDTH="33" HEIGHT="11" BORDER="0" ALT="Non-MS link"> SMUM, a leader in Internet marketing. Established in 1996, SMUM is a Seattle-based business owned by Wayne Berry, a well-known global programming consultant and co-author of Active X Programming Unleashed, Windows NT 4 Registry, and IIS 4.0 Special Edition.</i>
<P>


<P>
<P>







<!-- DOCUMENT CONTENT END -->

</DIV>

<DIV CLASS="clsDocBody">
<HR SIZE="1" />
<P><I>Did you find this article useful? Gripes? Compliments? Suggestions for other articles? <A TITLE="Go ahead. Make our day! Send us your thoughts." HREF="../../../sitebuilder/pg00573.htm" TARGET="_top">Write us!</A></I></P>
<P ID="pBackTop"><A HREF="classtech.htm#top" CLASS="clsBackTop"><IMG SRC="../../../workshop/graphics/top.gif" WIDTH="18" HEIGHT="8" BORDER="0" ALT="Back to top">Back to top</A></P>

<P CLASS="clsIncCpyRt">

</P>

&copy; <A CLASS="clsIncCpyRt" HREF="http://www.microsoft.com/misc/cpyright.htm" TARGET="_top">1998 Microsoft Corporation. All rights reserved. Terms of use</A>.

<P>&nbsp;</P>
</DIV>
<SCRIPT LANGUAGE="JavaScript"><!--

function CheckToTop()
{
var eBody = document.body;
if (eBody.scrollHeight > eBody.offsetHeight) pBackTop.style.display = 'block';
}

//--></SCRIPT>

<DIV ID="divMenu1" CLASS="clsMenu" ONMOUSEOVER="Menu_hover();" ONMOUSEOUT="Menu_hover();" ONCLICK="Menu_click();">
<DIV expURL="../../../sitebuilder/magazine/default.htm">Magazine Home</DIV>
<DIV expURL="../../../sitebuilder/magazine/jane.htm">Ask Jane</DIV>
<DIV expURL="../../../sitebuilder/magazine/dude.htm">DHTML Dude</DIV>
<DIV expURL="../../../sitebuilder/magazine/xml.htm">Extreme XML</DIV>
<DIV expURL="../../../sitebuilder/magazine/starters.htm">For Starters</DIV>
<DIV expURL="../../../sitebuilder/magazine/hess.htm">More or Hess</DIV>
<DIV expURL="../../../sitebuilder/magazine/server.htm">Servin' It Up</DIV>
<DIV expURL="../../../sitebuilder/magazine/site.htm">Site Lights</DIV>
<DIV expURL="../../../sitebuilder/magazine/webmen.htm">Web Men Talking</DIV>
</DIV>
<DIV ID="divMenu2" CLASS="clsMenu" ONMOUSEOVER="Menu_hover();" ONMOUSEOUT="Menu_hover();" ONCLICK="Menu_click();">
<DIV expURL="http://www.microsoft.com/sbnmember/default.asp">Member Community Home</DIV>
<DIV expURL="http://www.microsoft.com/sbnmember/freebies/default.asp">Benefits: Freebies &amp; Discounts</DIV>
<DIV expURL="http://www.microsoft.com/sbnmember/promote/default.asp">Benefits: Promote Your Site</DIV>
<DIV expURL="http://www.microsoft.com/sbnmember/connect/default.asp">Benefits: Connect with Your Peers</DIV>
<DIV expURL="http://www.microsoft.com/sbnmember/glance-lev.asp">Benefits at a Glance</DIV>
<DIV expURL="http://www.microsoft.com/sbnmember/osig/default.asp">Online Special-Interest Groups</DIV>
<DIV expURL="http://www.microsoft.com/sbnmember/levels/member.asp">Your Membership</DIV>
<DIV expURL="http://www.microsoft.com/sbnmember/freebies/stores.asp">SBN Stores</DIV>
<DIV expURL="http://www.microsoft.com/sbnmember/apply/registration.asp">Join Now</DIV>
</DIV>
<DIV ID="divMenu3" CLASS="clsMenu" ONMOUSEOVER="Menu_hover();" ONMOUSEOUT="Menu_hover();" ONCLICK="Menu_click();">
<DIV expURL="../../../workshop/default.htm">Workshop Home</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/workshop/essentials/default.htm">Essentials</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/workshop/delivery/default.htm">Content &amp; Component Delivery</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/workshop/components/default.htm">Component Development</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/workshop/database/default.htm">Data Access &amp; Databases</DIV>
<DIV expURL="../../../workshop/design/default.htm">Design</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/workshop/author/default.htm">DHTML, HTML &amp; CSS</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/xml/default.htm">Extensible Markup Language (XML)</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/workshop/languages/default.htm">Languages &amp; Development Tools</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/workshop/messaging/default.htm">Messaging &amp; Collaboration</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/workshop/networking/default.htm">Networking, Protocols &amp; Data Formats</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/workshop/browser/default.htm">Reusing Browser Technology</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/workshop/security/default.htm">Security &amp; Cryptography</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/workshop/server/default.htm">Server Technologies</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/workshop/imedia/default.htm">Streaming &amp; Interactive Media</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/workshop/management/default.htm">Web Content Management</DIV>
<DIV expURL="../../../workshop/index/default.htm">Workshop Index</DIV>
</DIV>
<DIV ID="divMenu4" CLASS="clsMenu" ONMOUSEOVER="Menu_hover();" ONMOUSEOUT="Menu_hover();" ONCLICK="Menu_click();">
<DIV expURL="../../../gallery/default.htm">Tools &amp; Samples Home</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/gallery/tools/default.htm">Tools</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/gallery/samples/default.htm">Samples, Headers, Libs</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/gallery/images/default.htm">Images</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/gallery/sounds/default.htm">Sounds</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/gallery/stylesheets/default.htm">Style Sheets</DIV>
<DIV expURL="http://www.microsoft.com/typography/fontpack/win.htm">Web Fonts</DIV>
</DIV>
<DIV ID="divMenu5" CLASS="clsMenu" ONMOUSEOVER="Menu_hover();" ONMOUSEOUT="Menu_hover();" ONCLICK="Menu_click();">
<DIV expURL="../../../devtraining/default.htm">Training Home</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/devtraining/seminars/default.htm">SBN Live Seminars</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/devtraining/chat/default.htm">SBN Live Chats</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/devtraining/atec.htm">Courses</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/devtraining/peer/default.htm">Peer Support</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/devtraining/mastering.htm">CD-ROM Training</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/devtraining/books_kits.htm">Books & Training Kits</DIV>
<DIV expURL="../../../workshop/c-frame.htm#/devtraining/mscert/default.htm">Certification</DIV>
</DIV>
<DIV ID="divMenu6" CLASS="clsMenu" ONMOUSEOVER="Menu_hover();" ONMOUSEOUT="Menu_hover();" ONCLICK="Menu_click();">
<DIV expURL="../../../sitebuilder/default.htm">SBN Home</DIV>
<DIV expURL="../../../sitebuilder/siteinfo/newtosite.htm">New to SBN?</DIV>
<DIV expURL="../../../sitebuilder/whatsnew.htm">What's New on SBN</DIV>
<DIV expURL="../../../sitebuilder/siteinfo/sitemap.htm">Site Map</DIV>
<DIV expURL="http://www.microsoft.com/isapi/gosearch.asp?TARGET=/dev/web/default.asp">Site Search</DIV>
<DIV expURL="../../../sitebuilder/siteinfo/glossary/default.htm">Glossary</DIV>
<DIV expURL="../../../sitebuilder/write-us.htm">Write Us</DIV>
<DIV expURL="../../../sitebuilder/siteinfo/about.htm">About This Site</DIV>
</DIV>
<SCRIPT LANGUAGE="JavaScript" SRC="../../../sitebuilder/shared/js/navbar.js"></SCRIPT> 
<SCRIPT LANGUAGE="JavaScript" SRC="../../../sitebuilder/shared/js/navlinks.js"></SCRIPT>


</BODY>
</HTML>